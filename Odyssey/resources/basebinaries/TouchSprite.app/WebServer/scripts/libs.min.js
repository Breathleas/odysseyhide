var tokenstart="";!function(a){"object"==typeof exports&&"object"==typeof module?a(require("cd"),require("lua")):"function"==typeof define&&define.amd?define(["cd","lua"],a):a(CodeMirror)}(function(a){function b(a,b){if(!Array.prototype.indexOf){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return-1!=a.indexOf(b)}function c(a,b,c,e,h){var i=a.getCursor(),j=e(a,i);return tokenstart=j.string,{list:f(j,b,c,h),from:g(i.line,d(j)),to:g(i.line,j.end)}}function d(a){var b=a.string.lastIndexOf(".");return 0>b?a.start+1:a.start+b+1}function e(b,d){return c(b,a.velocityContext,a.velocityCustomizedKeywords,function(a,b){return a.getTokenAt(b)},d)}function f(a,c,d,e){var f,g,h=[],i=a.string;i&&i.length&&(f=a.string.charAt(0),i=i.substring(1,i.lenght),g=i.split(".").length-1);var j=null,k=new RegExp(/[A-Za-z]/);if(k.test(f)){var l=new RegExp("\\b"+f+i+"\\w+\\.?\\b","gi");j=0==g?c.match(l):d.match(l)}if(j&&j.length)for(var m=0;m<j.length;m++)!b(h,j[m])&&g>0?h.push(j[m].substring(i.lastIndexOf(".")+1,j[m].length)):h.push(j[m]);return h}var g=a.Pos;a.registerHelper("hint","lua",e)}),$(function(){function a(){document.title=STRINGS.WIFI_TRANS_TITLE,$(".table_header .filename").text(STRINGS.FILENAME),$(".table_header .size").text(STRINGS.FILE_SIZE),$(".table_header .operate").text(STRINGS.FILE_OPER)}function b(a){var b="files"+a.siblings(":first").attr("filepath");I("show"),$.get(b,function(a){D(a),I("hide")})}function c(a){if(confirm(STRINGS.CONFIRM_DELETE_BOOK)){I("show");var b="files"+a.siblings(":first").attr("filepath"),c=a.parent();$.post(b,{_method:"delete"},function(a){if("success"==a.data)setTimeout(function(){c.slideUp("fast",function(){c.remove()})},300),c.css({color:"#fff","background-color":"#cb4638"}),c.find(".trash").unbind(),c.find(".enlarge").unbind(),c.find(".edit").unbind(),c.find(".download").unbind();else if("fail"==a.data)return void J("不可删除")},"json"),I("hide")}}function d(){var a="files"+$(this).siblings(":first").attr("filepath");window.location=a}function e(){var a=new Date,b="getfiles.json";I("show"),$.getJSON(b+a.getTime(),function(a){f(a),I("hide")})}function f(a){h(a),$(".download").click(d),$(".edit").click(function(){Y=$(this).siblings(":first").attr("filename"),Z=$(this).siblings(":first").attr("filepath"),S=!1;var a=$(this);$("#compilebox").show(function(c){$(".copoil-code").append($(V)),T=!0,b(a)})}),$(".enlarge").on("click",function(a){a.stopPropagation();var b="files"+$(this).siblings(":first").attr("filepath");$(".showfiles").fadeIn(function(){$(this).find("img").attr("src",b)})}),$(".trash").click(function(a){var b=$(this);c(b),a.stopPropagation()})}function g(){document.body.onclick=function(a){a.altKey&&a.ctrlKey&&0==a.button&&(U+=1,11==U&&J("<img src='http://www.play4u.cn/img/top_logo_p4u.png' alt='帮你玩科技'>"))}}function h(a){var b=$(window).height()-$("#right .content_title").height()-$("#right .table_header").height(),c=$("#right .files");c.empty(),c.height("auto");for(var d=(Math.floor(b/40),0);d<a.length;d++){var e=$('<div class="file"></div>'),f=a[d],g=unescape(f.name),h=g.substring(g.lastIndexOf(".")+1);1==f.type?(e.append('<div class="column filename" filepath="'+f.path+'" filename="'+escape(f.name)+'" filetype="'+escape(f.type)+'"><div class="filesnamebox">'+unescape(f.name)+'/</div><div class="filerenamebox"><input class="filerenameboxinput" value="'+unescape(f.name)+'"><button class="filerenameboxbtn"></button></div></div>'),e.append('<div class="column size"></div>'),e.append('<div class="trash operationbtn"><span class="titlemes">'+STRINGS.DELETE_FILE+"</span></div>"),e.append('<div class="revisebtn operationbtn"><span class="titlemes">改名</span></div>')):(e.append('<div class="column filename" filepath="'+f.path+'" filename="'+escape(f.name)+'" filetype="'+escape(f.type)+'">'+unescape(f.name)+"</div>"),e.append('<div class="column size">'+u(f.size)+"</div>"),e.append('<div class="trash operationbtn"><span class="titlemes">'+STRINGS.DELETE_FILE+"</span></div>"),"png"==h||"jpg"==h||"gif"==h?e.append('<div class="enlarge operationbtn"><span class="titlemes">查看</span></div>'):e.append('<div class="edit operationbtn"><span class="titlemes">'+STRINGS.EDETEOR_FILE+"</span></div>"),e.append('<div class="download operationbtn"><span class="titlemes">'+STRINGS.DOWNLOAD_FILE+"</span></div>")),c.append(e)}return j(),m(),b}function j(){$(".revisebtn").click(function(a){ha=!0,$(".filesnamebox").show(),$("filerenamebox").hide(),a.stopPropagation(),ea=unescape($(this).siblings(".filename").attr("filename")),ca=$(this).siblings(".filename").find(".filesnamebox"),da=$(this).siblings(".filename").find(".filerenamebox"),ca.hide();var b=$(this);da.show(0,function(){da.find(".filerenameboxinput").val(ea);var c=$(this).parent(".filename").attr("filepath");$(this).find(".filerenameboxbtn").click(function(){ba=da.find(".filerenameboxinput").val(),a.stopPropagation();var d=c.split("/");d.pop(),d.push(ba);var e=d.join("/");I("show");var f=(new Date).getTime();$.post(f,{_method:"rename",oldpath:c,newpath:e},function(a){"success"==a.data?(b.siblings(".filename").attr("filename",ba),b.siblings(".filename").attr("filepath",e),b.siblings(".filename").find(".filesnamebox").text(ba+"/"),q(),ca.show(),da.hide(),ha=!1):J(a.msg),I("hide")},"json")})}),da.click(function(a){a.stopPropagation()}),k()})}function k(){$("body").click(function(){ca.show(),da.hide(0,function(){da.find(".filerenameboxinput").val(ea),ha=!1})})}function l(){window.onkeydown=function(a){a.altKey&&a.ctrlKey&&109==a.keyCode&&(aa+=1,6==aa&&(window.location="https://dev.touchsprite.com/"))}}function m(){$(".filename[filetype='1']").parent(".file").css("cursor","pointer"),$(".filename[filetype='1']").parent(".file").click(function(){if(!ha){var a=unescape($(this).find(".filename").attr("filename")),b=$(this).find(".filename").attr("filepath");_=decodeURIComponent(b),I("show");var c=(new Date).getTime();$.post(c,{path:_,_method:"dir"},function(b){var c=$(".nav-header").html(),d=c+"<a class='rootpath gopath'>"+a+"</a>/";$(".nav-header").html(d),$(".rootpath").click(function(){var a=this;n(a)}),f(b),I("hide")},"json")}})}function n(a){var b=$(".rootpath").index(a),c=$(".nav-header").text(),d=c.split("/");d.shift();var e=d.length;d.length=b,d.push("");var g=d.join("/"),h="";if(1==d.length)h="",_="";else{h="/"+g;var j=g.substring(0,g.length-1);_="/"+decodeURIComponent(j)}if(e>b+1){I("show");var k=(new Date).getTime();$.post(k,{path:h,_method:"dir"},function(a){d.pop();var b='<a class="rootpath">TouchSprite</a>/';for(i=0;i<d.length;i++)b+='<a class="rootpath">'+d[i]+"</a>/";$(".nav-header").html(b);$(".rootpath").click(function(){var a=this;n(a)}),f(a),I("hide")},"json")}}function o(){var a=(new Date).getTime(),b="progress/"+encodeURI(K)+"?"+a;$.getJSON(b,function(a){if(!a){if(P++,5>P)return void setTimeout(o,500);J(STRINGS.USE_ONE_BROWSER)}P=0;var b=$("#right .file [filename='"+escape(a.fileName)+"']"),c=b.next();c.text(a.size);var d=c.next();d.text(Math.round(100*a.progress)+"%");var e=b.prev();e.animate({width:Math.round(688*a.progress)},280),a.progress<1?setTimeout(o,300):d.text("")})}function p(){if(!(O||N>=M.length)){O=!0;var a=$(M[N]),b=a.attr("id"),e=a.val(),f=e.split("\\");e=f[f.length-1],N++;var g=$("#right .file [filename='"+escape(e)+"']").parent();$.ajaxFileUpload({url:"files",secureuri:!1,fileElementId:b,dataType:"text",success:function(a,b){g.removeClass("progress_wrapper"),g.find(".progress").remove(),g.find(".precent").text("").remove(),$('<div class="download operationbtn"><span class="titlemes">'+STRINGS.DOWNLOAD_FILE+"</span></div>").click(d).appendTo(g),$('<div class="trash operationbtn"><span class="titlemes">'+STRINGS.DELETE_FILE+"</span></div>").click(function(a){var b=$(this);c(b),a.stopPropagation()}).appendTo(g),O=!1,g.find(".download").text(""),p()},error:function(a,b,c){O=!1,J(STRINGS.UPLOAD_FAILED),g.remove(),p()}}),K=e,setTimeout(o,300)}}function q(){_.indexOf("chudong")>-1&&(window.onkeydown=function(a){a.altKey&&a.ctrlKey&&a.shiftKey&&106==a.keyCode&&(ga+=1,17==ga&&J("请使用正版帮你玩"))})}function r(a){var b=a.split("\\");a=b[b.length-1];var c=$("#right .file [filename='"+escape(a)+"']");return c.length>0?($(this).val(""),c.parent().hasClass("progress_wrapper")?STRINGS.FILE_IN_QUEUE:STRINGS.FILE_EXISTS):null}function s(a){var b=w();if(1==a.length){var c=r(a[0].path||a[0].fileName);return c?void J(c):void b.add(a[0])}for(var d=a.length,e=0,f=0;f<a.length;++f)r(a[f].path||a[f].fileName)||(b.add(a[f]),e++);if(d!=e){var c=STRINGS.YOU_CHOOSE+d+STRINGS.CHOSEN_FILE_COUNT+e+STRINGS.VALID_CHOSEN_FILE_COUNT;J(c)}}function t(a){$(a).unbind(),$(a).change(function(){if(this.files){var b=this.files[0].name;return this.files[0].path="files"+_+"/"+b,void s(this.files)}var c=$(this).val(),d=r(c);if(d)return void J(d);var e=c.split("\\");c=e[e.length-1];var f=$('<div class="file progress_wrapper"></div>');f.append('<div class="progress"></div>'),f.append('<div class="column filename" filepath='+_+"/"+c+' filename="'+escape(c)+'">'+c+"</div>"),f.append('<div class="column size"> - </div>'),f.append('<div class="column precent">0%</div>'),$("#right .files").prepend(f),M.push(a),$(a).css({top:"-9999px",left:"-9999px"}),$(".file_upload_warper").append('<input type="file" name="newfile" value="" id="newfile_'+M.length+'" class="file_upload" />'),t("#newfile_"+M.length),p()}),"undefined"!=typeof Worker?$(a).mouseover(function(){$("#upload_button").removeClass("normal").addClass("pressed")}).mouseout(function(){$("#upload_button").removeClass("pressed").addClass("normal")}).mousedown(function(){$("#upload_button").removeClass("normal").addClass("pressed")}).mouseup(function(){$("#upload_button").removeClass("pressed").addClass("normal")}):$(a).mouseover(function(){$("#upload_button").css("background-image",'url("images/select_file1_rollover.jpg")')}).mouseout(function(){$("#upload_button").css("background-image",'url("images/select_file1.jpg")')}).mousedown(function(){$("#upload_button").css("background-image",'url("images/select_file1_pressed.jpg")')}).mouseup(function(){$("#upload_button").css("background-image",'url("images/select_file1.jpg")')})}function u(a){for(var b=0,c=["bytes","KB","MB","GB","TB"];a>1024;)a/=1024,b++;return a.toFixed(1)+" "+c[b]}function v(){var a=w(),b=$(this).parent().find(".filename").attr("filename");b&&(item=R[b],item&&a.abort(item))}function w(){return Q?Q.options.url=_:Q=new bitcandies.FileUploader({url:_,maxconnections:1,fieldname:"newfile",enqueued:function(a){var b=a.getFilename();R[escape(b)]=a;var c=a.getSize(),d=$('<div class="file progress_wrapper"></div>');d.append('<div class="progress"></div>'),d.append('<div class="column filename" filepath='+_+"/"+b+' filename="'+unescape(b)+'">'+unescape(b)+"</div>"),d.append('<div class="column size">'+u(c)+"</div>"),d.append('<div class="column precent">0%</div>'),$('<div class="column trash_white" title="'+STRINGS.CANCEL+'"></div>').click(v).appendTo(d),$("#right .files").prepend(d)},progress:function(a,b,c){var d=a.getFilename(),e=b/c,f=$("#right .file [filename='"+unescape(d)+"']"),g=f.next().next();g.text(Math.round(100*e)+"%");var h=f.prev();h.width(688*e)},success:function(a){var e=(a.file.name,a.getFilename()),f=$("#right .file [filename='"+unescape(e)+"']").parent();f.removeClass("progress_wrapper"),f.find(".progress").remove(),f.find(".precent").text("").remove(),f.find(".trash_white").remove();var h=e.substring(e.lastIndexOf(".")+1);$('<div class="trash operationbtn"><span class="titlemes">'+STRINGS.DELETE_FILE+"</span></div>").click(function(a){var b=$(this);c(b),a.stopPropagation()}).appendTo(f),"png"==h||"jpg"==h||"gif"==h?$('<div class="enlarge operationbtn"><span class="titlemes">'+STRINGS.LOCK_FILE+"</span></div>").click(function(a){a.stopPropagation();var b="files"+$(this).siblings(":first").attr("filepath");$(".showfiles").fadeIn(function(){$(this).find("img").attr("src",b),l()})}).appendTo(f):$('<div class="edit operationbtn"><span class="titlemes">'+STRINGS.EDETEOR_FILE+"</span></div>").click(function(){Y=$(this).siblings(":first").attr("filename"),Z=$(this).siblings(":first").attr("filepath");var a=$(this);S=!1,$("#compilebox").show(function(c){$(".copoil-code").append($(V)),g(),T=!0,b(a)})}).appendTo(f),$('<div class="download operationbtn"><span class="titlemes">'+STRINGS.DOWNLOAD_FILE+"</span></div>").click(d).appendTo(f),J("上传成功")},error:function(a){var b=a.getFilename(),c=$("#right .file [filename='"+escape(b)+"']").parent();c.remove()},aborted:function(a){var b=a.getFilename(),c=$("#right .file [filename='"+escape(b)+"']").parent();c.remove()}}),Q}function x(a){a.stopPropagation(),a.preventDefault(),L||($(this).removeClass("normal").addClass("active"),L=!0)}function y(a){a.stopPropagation(),a.preventDefault(),$(this).removeClass("active").addClass("normal"),L=!1}function z(a){a.stopPropagation(),a.preventDefault();w();$(this).removeClass("active").addClass("normal"),L=!1;var b=a.dataTransfer.files[0].name;a.dataTransfer&&a.dataTransfer.files&&(a.dataTransfer.files[0].path="files"+_+"/"+b,s(a.dataTransfer.files))}function A(){var a=document.getElementById("drag_area");a&&a.addEventListener&&(a.addEventListener("dragover",x,!1),a.addEventListener("dragleave",y,!1),a.addEventListener("drop",z,!1))}function B(){$('<div id="drag_area"></div)').addClass("normal").appendTo("#logo");$("#upload_hint").empty(),$("<div>"+STRINGS.SELECT_YOUR_FILES+"</div>").addClass("hint").insertAfter("#upload_button");var a=$('<div class="button_lables"></div>').prependTo("#upload_button");$('<div class="button_lable1"></div>').text(STRINGS.SELECT_BUTTON_LABLE1).appendTo(a),A()}function C(){$("#logo").append('<img src="images/logo.jpg" />').append('<div class="wifi">'+STRINGS.WIFI_AVAILABLE+"</div>"),$("#upload_button").css("background-image",'url("images/select_file1_rollover.jpg")'),$("#upload_hint").html(STRINGS.SELECT_YOUR_FILES+"<br />"+STRINGS.SUPPORTED_FILE_TYPES),$('<div class="button_lable">'+STRINGS.SELECT_BUTTON_LABLE+"</div>").prependTo("#upload_button")}function D(a){var b=document.getElementById("codmirr");W=CodeMirror.fromTextArea(b,{matchBrackets:!0,lineNumbers:!0,lineWrapping:!0,indentUnit:4,value:"",mode:{name:"lua",globalVars:!0},theme:"base16-dark",dragDrop:!0}),W.setSize("100%","100%"),W.setValue(a),fa=W.getValue(),W.setOption("extraKeys",{"Ctrl-S":function(){E(fa)},"Cmd-S":function(){E(fa)},"Ctrl-Q":"autocomplete"}),W.on("change",function(){W.showHint()})}function E(a){if(X=W.getValue(),X==a)var b=!1;else var b=!0;if(S)$(".newfliebox").fadeIn(function(){$(this).find(".newflienameipu").val("")});else{if(!b)return!1;I("show");var c=(new Date).getTime();X=encodeURIComponent(X),$.post(c,{path:Z,_method:"revise",fileVal:X},function(a){"success"==a.data?(fa=W.getValue(),J("保存成功")):J("保存失败"),I("hide")},"json")}}function F(){$(".newflienetxt").click(function(){var a=W.getValue(),e=$(".newflienameipu").val();if(e){var f=_+"/"+e;console.log(e);var g=e.lastIndexOf(".");e.substring(e.lastIndexOf(".")+1);if(g>0){I("show");var h=(new Date).getTime();$.post(h,{_method:"newfile",path:f,fileVal:encodeURIComponent(a)},function(a){if("success"==a.data){var g=$('<div class="file"></div>'),h='<div class="column filename" filepath="'+f+'" filename="'+e+'">'+e+"</div>",i='<div class="column size">'+u(a.length)+"</div>",j='<div class="download operationbtn"><span class="titlemes">'+STRINGS.DOWNLOAD_FILE+"</span></div>",k='<div class="edit operationbtn"><span class="titlemes">'+STRINGS.EDETEOR_FILE+"</span></div>",l='<div class="trash operationbtn"><span class="titlemes">删除</span></div>';$(g).appendTo($(".files")),$(h).appendTo($(g)),$(i).appendTo(g),$(l).click(function(a){var b=$(this);c(b),a.stopPropagation()}).appendTo(g),G(),$(k).click(function(){Y=$(this).siblings(":first").attr("filename"),Z=$(this).siblings(":first").attr("filepath");var a=$(this);S=!1,$("#compilebox").show(function(c){$(".copoil-code").append($(V)),T=!0,b(a)})}).appendTo(g),$(j).click(d).appendTo(g)}else J("创建失败");I("hide")},"json")}else J("请输入文件类型")}}),$(".newfliecancle").click(function(){$(".newflienameipu").val(""),$(".newfliebox").fadeOut()})}function G(){$("#compilebox").hide(0,function(){$(".copoil-code #codmirr").remove(),$(".CodeMirror").remove(),$(".newfliebox").hide()})}function H(){$(".newfilesbox").fadeOut(50,function(){$(".newfilesinputname").val("")})}function I(a){"show"==a?$("#loading").fadeIn(50):"hide"==a&&$("#loading").fadeOut(50)}function J(a){$(".msgbox").stop(!0,!0).fadeIn(50,function(){$(this).html(a)}).delay(2e3).fadeOut(50)}var K,L=!1,M=[],N=0,O=!1,P=0,Q=null,R={},S="",T="",U=0,V='<textarea id="codmirr" name="codmirr"></textarea>',W="",X="",Y="",Z="",_="",aa=0,ba="",ca="",da="",ea="",fa="",ga=0,ha=!1;$(document).ready(function(){CodeMirror.velocityContext="and break elseif false nil not or return true function end if then else do while repeat until for in local close flush lines read seek setvbuf write init touchDown touchUp touchMove getColor getColorRGB findColorInRegionFuzzy findImageInRegionFuzzy findMultiColorInRegionFuzzy findMultiColorInRegionFuzzyExt saveImageToAlbum dialog toast dialogRet dialogInput showUI openURL initLog wLog closeLog nLog playAudio ocrText addDmOcrDict dmOcrText keepScreen runApp closeApp getScreenSize getDeviceType getDeviceID deviceIsAuth userPath lua_exit pressHomeKey doublePressHomeKey isFrontApp resetIDLETimer vibrator lockDevice deviceIsLock unlockDevice getNetTime writePasteboard readPasteboard getTSVer getOSVer getOSVer checkScriptAuth frontAppBid luaExitIfCall clearKeyChain setWifiEnable setBTEnable setAirplaneMode catchTouchPoint fakeGPS appBundlePath appDataPath appIsRunning lua_restart setScreenResolution beforeUserExit tohex fromhex md5 sha1 aes128_encrypt base64_encode base64_decode aes128_decrypt split rtrim ltrim trim atrim fromgbk click dbclick touchMoveTo angleBetween distanceBetween polarProjection cmpColor coroutine debug io math os package string table sz ftp plist showFloatButton addDmOcrDictEx findImage dmFindText setScreenScale",CodeMirror.velocityCustomizedKeywords="coroutine.create coroutine.resume coroutine.running coroutine.status coroutine.wrap coroutine.yield debug.debug debug.getfenv debug.gethook debug.getinfo debug.getlocal debug.getmetatable debug.debug debug.getfenv debug.gethook debug.getinfo debug.getlocal debug.getmetatable debug.getregistry debug.getupvalue debug.setfenv debug.sethook debug.setlocal debug.setmetatable debug.setupvalue debug.traceback io.close io.flush io.input io.lines io.open io.output io.popen io.read io.stderr io.stdin io.stdout io.tmpfile io.type io.write math.abs math.acos math.asin math.atan math.atan2 math.ceil math.cos math.cosh math.deg math.exp math.floor math.fmod math.frexp math.huge math.ldexp math.log math.log10 math.max math.min math.modf math.pi math.pow math.rad math.random math.randomseed math.sin math.sinh math.sqrt math.tan math.tanh os.clock os.date os.difftime os.execute os.exit os.getenv os.remove os.rename os.setlocale os.time os.tmpname package.cpath package.loaded package.loaders package.loadlib package.path package.preload package.seeall string.byte string.char string.dump string.find string.format string.gmatch string.gsub string.len string.lower string.match string.rep string.reverse string.sub string.upper table.concat table.insert table.maxn table.remove table.sort sz.json.encode sz.json.decode ftp.download ftp.upload ftp.cmd plist.read plist.write",F(),a(),e(),t("#newfile_0"),"undefined"!=typeof Worker?B():C(),$(document).ajaxError(function(a,b,c){J(STRINGS.CANNOT_CONNECT_SERVER),$(".progress_wrapper, .progress").css({background:"#f00"})}),$("body").click(function(){$(".showfiles").fadeOut(200)}),$(".add-new-script").click(function(){S=!0,$("#compilebox").show(function(a){$(".copoil-code").append($(V)),D(""),T=!0})}),$(".copmile-save-btn").click(function(){E(fa)}),$(".copmile-close").click(function(){if(X=W.getValue(),X==fa)var a=!1;else var a=!0;S?$(".querenbtn").fadeIn(200):a?$(".querenbtn").fadeIn(200):G()}),$(".querenbtn-ok").click(function(){S?($(".querenbtn").fadeOut(200),$(".newfliebox").fadeIn(function(){$(this).find(".newflienameipu").val("")})):($(".querenbtn").fadeOut(200),E(fa),G())}),$(".querenbtn-no").click(function(){$(".querenbtn").fadeOut(200),G()}),$(".add-new-fail").click(function(){$(".newfilesbox").fadeIn()}),$(".newFilesno").click(function(){$(".newfilesbox").fadeOut(50,function(){$(".newfilesinputname").val("")})}),$(".newFilesok").click(function(){var a=$(".newfilesinputname").val(),b=$(".nav-header").text(),d=b.split("/"),e=(d.shift(),d.join("/")),f="/"+e+a;if(a){I("show");var g=(new Date).getTime();$.post(g,{folderPath:f,_method:"newFolder"},function(b){if("success"==b.data){J("创建成功");var d=$('<div class="file"></div>'),e='<div class="column filename" filepath="'+f+'" filename="'+a+'" filetype="1"><div class="filesnamebox">'+a+'/</div><div class="filerenamebox"><input class="filerenameboxinput" value="'+a+'"><button class="filerenameboxbtn"></button></div></div>',g='<div class="column size"></div>',h='<div class="revisebtn operationbtn"><span class="titlemes">改名</span></div>',i='<div class="trash operationbtn"><span class="titlemes">删除</span></div>';$(d).appendTo($(".files")),$(e).appendTo(d),$(g).appendTo(d),$(i).click(function(a){var b=$(this);c(b),a.stopPropagation()}).appendTo(d),$(h).click(function(a){j(),a.stopPropagation()}).appendTo(d),H(),m()}else J(b.msg);I("hide")},"json")}})})});var bitcandies=bitcandies||{};bitcandies.defaults=function(a,b){for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c])},bitcandies.FileUploader=function(a){var b={fieldname:"file",maxconnections:2,method:"POST",default_params:{},url:"",enqueued:function(a){},aborted:function(a){},start:function(a,b){},progress:function(a,b,c,d){},success:function(a,b){},error:function(a,b){},complete:function(a,b){}};this.options=a||{},bitcandies.defaults(this.options,b),this.queue=[],this.running=[],this.completed=[],this._curid=1},bitcandies.FileUploader.Statuses={QUEUED:"queued",ABORTED:"aborted",UPLOADING:"uploading",COMPLETED:"completed"},bitcandies.FileUploader.QueuedFile=function(a,b,c,d){if(!(b instanceof File))throw new Error("Cannot add a non-File object to upload queue.");this.uploader=a,this.file=b,this.params=c||{},this.id=d,this.status=bitcandies.FileUploader.Statuses.QUEUED},bitcandies.FileUploader.QueuedFile.prototype={getFilename:function(){return this.file.fileName?this.file.fileName:this.file.name},getSize:function(){return this.file.fileSize?this.file.fileSize:this.file.size},getFile:function(){return this.file},getParams:function(){return this.params},getStatus:function(){return this.status}},bitcandies.FileUploader.prototype={add:function(a,b){b=b||{},bitcandies.defaults(b,this.options.default_params);var c=new bitcandies.FileUploader.QueuedFile(this,a,b,this._curid);return this._curid++,this.queue.push(c),this.options.enqueued.call(this,c),this.run(),c},abort:function(a){if(a.status!==bitcandies.FileUploader.Statuses.COMPLETED&&a.status!==bitcandies.FileUploader.Statuses.ABORTED){for(var b=0;b<this.queue.length;++b)if(a.id===this.queue[b].id)return this.queue.splice(b,1),a.status=bitcandies.FileUploader.Statuses.ABORTED,void this.options.aborted.call(this,a);for(var b=0;b<this.running.length;++b)if(a.id===this.running[b].id)return a.status=bitcandies.FileUploader.Statuses.ABORTED,a.xhr.abort(),void this.options.aborted.call(this,a)}},doUpload:function(a){var b=this,c=new XMLHttpRequest,d=new FormData;a.status=bitcandies.FileUploader.Statuses.UPLOADING,a.xhr=c,this.options.start.call(this,a,c),c.onreadystatechange=function(){4==c.readyState&&b.onComplete(a,c)},c.upload.onprogress=function(d){d.lengthComputable&&b.options.progress.call(b,a,d.loaded,d.total,c)},c.open(this.options.method,this.options.url,!0),console.log(this.options.url),console.log(a.params);for(var e in a.params)d.append(e,a.params[e]);d.append(this.options.fieldname,a.file),c.send(d)},isRunning:function(){return this.queue.length||this.running.length},onComplete:function(a,b){a.status!==bitcandies.FileUploader.Statuses.ABORTED&&(a.status=bitcandies.FileUploader.Statuses.COMPLETED,this.options.progress.call(this,a,a.getSize(),a.getSize(),b),200==b.status?this.options.success.call(this,a,b):this.options.error.call(this,a,b),this.options.complete.call(this,a,b)),a.xhr&&delete a.xhr;for(var c in this.running)if(this.running[c].id===a.id){this.running.splice(c,1);break}this.run()},run:function(){if(this.queue.length>0&&this.running.length<this.options.maxconnections)for(var a=0;a<this.options.maxconnections-this.running.length;++a){var b=this.queue.shift();this.running.push(b),this.doUpload(b)}}};